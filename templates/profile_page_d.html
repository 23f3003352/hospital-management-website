<!-- profile page of Doctor -->

<!-- 3 views, one for Doctor, admin and Patient -->
 <!-- Doctor - availability adding feature -->
  <!-- patient - appointment booking feature -->
    <!-- admin - see all the doctor's Appointment -->

{% extends 'layout.html' %}
{% block content %}
<h1>Doctor Profile Page</h1>

<div class="flex-column gap-16p" style="align-items: center;">
<div class="flex-column mx-auto gap-16p mt-5" style = "align-items: center; display: flex">
<!-- content -->
<!-- <div class="flex-row row gap-100p" style="flex-wrap: nowrap; align-items: center;"> -->
<div class="flex-row gap-120p">
    <div class="profile-container d-flex flex-column align-items-center" style="width: 50%; border-radius: 100px; overflow: clip; align-items: center">
    <img src="{{ url_for('static', filename='images/doctor_avatar.jpg') }}" alt="Doctor Avatar" class="avatar-img mb-3" style="width: 120px; border-radius: 300px; ">
    </div>
    <div class="profile-details flex-column gap-16p">

        <div class="flex-row gap-12p" style="align-items: center; justify-content: flex-end">
            <div class="profile-label">Username</div>
            <div class="profile-field">{{ doc.username }}</div>
        </div>

        <div class="flex-row gap-12p" style="align-items: center; justify-content: flex-end">
            <div class="profile-label">Name</div>
            <div class="profile-field">{{ doc.name }}</div>
        </div>

        <div class="flex-row gap-12p" style="align-items: center; justify-content: flex-end">
            <div class="profile-label">specialization</div>
            <div class="profile-field">{{ doc.specialization }}</div>
        </div>
    </div>
</div>
</div>
<a class="btn btn-danger" href="{{ url_for('logout') }}">Logout</a>
</div>

<!-- remove all if needed cuz not wriiten manually -->
<h3 class="mb-4">Schedule Meeting</h3>

<form method="POST" id="bookingForm">
    {{ form.hidden_tag() }}

    <input type="hidden" id="selected_date" name="appointment_date">
    <input type="hidden" id="selected_slot" name="slot">

    {% for day in days %}
        <div class="mb-3">
            <h5 class="mb-0">{{ day.strftime('%d %b %Y') }}</h5>

            <div class="d-flex gap-2p flex-wrap" style="justify-content: flex-start; margin-left: 20px; gap: 40px;">
                {% for slot_key, slot_label in slot_map.items() %}
                
                {% set free = availability[day][slot_key] %}

                <button 
                    type="button"
                    class="slot-btn btn 
                        {% if free %}btn-light{% else %}btn-secondary{% endif %}"
                    data-date="{{ day }}"
                    data-slot="{{ slot_key }}"
                    {% if not free or current_user.is_doctor %}disabled{% endif %}
                >
                    {{ slot_label }}
                </button>
                {% endfor %}
            </div>
        </div>
    {% endfor %}
        
    <button 
        id="bookButton" 
        class="btn mybutton mt-3" 
        type="submit"
        style="display:none;">
        Book Appointment
    </button>
</form>


<script>
document.querySelectorAll(".slot-btn").forEach(btn => {
    btn.addEventListener("click", function() {
        // Remove highlight from other slots
        document.querySelectorAll(".slot-btn").forEach(b => b.classList.remove("btn-info"));
        this.classList.add("btn-info");

        // Set hidden values
        document.getElementById("selected_date").value = this.dataset.date;
        document.getElementById("selected_slot").value = this.dataset.slot;

        // Show book button
        document.getElementById("bookButton").style.display = "block";
    });
});
</script>

{% endblock %}